version: '3.8'

services:
  ardupilot-fuzz:
    build:
      context: .
      dockerfile: Dockerfile.improved
      args:
        SCRIPT_TO_RUN: ardupilot
        GIT_TOKEN: ${GIT_TOKEN}
    image: configfuzz:ardupilot
    container_name: fuzz_ardupilot_improved
    volumes:
      # 결과 파일을 호스트에 저장
      - ./output:/conffuzz/output
      - ./logs:/conffuzz/logs
    environment:
      - PYTHONUNBUFFERED=1
      - LOG_LEVEL=INFO
    # 다양한 실행 옵션
    # command: /conffuzz/run.sh test  # 5분 테스트
    # command: /conffuzz/run.sh dry-run  # Dry run
    command: python3 run_improved.py --timeout 3600 --threads 10 -r -s
    
  # 다른 프로젝트들도 추가 가능
  # px4-fuzz:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.improved
  #     args:
  #       SCRIPT_TO_RUN: px4
  #   image: configfuzz:px4
  #   container_name: fuzz_px4_improved
  #   volumes:
  #     - ./output_px4:/conffuzz/output
  #   command: python3 run_improved.py --timeout 3600 -r -s